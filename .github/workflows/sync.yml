name: Sync Markdown to victoriadrake.github.io

on:
  push:
    branches:
      - main

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout hashnode-blog repo
      uses: actions/checkout@v3
      with:
        repository: victoriadrake/hashnode-blog
        path: hashnode-blog

    - name: Checkout victoriadrake.github.io repo
      uses: actions/checkout@v3
      with:
        repository: victoriadrake/victoriadrake.github.io
        path: victoriadrake.github.io
        token: ${{ secrets.TOKEN }}

    - name: Copy markdown files to victoriadrake.github.io with date-based directories
      run: |
        # Get the current date in YYYY-MM-DD format
        current_date=$(date +%Y-%m-%d)
        for file in $(find hashnode-blog/ -name '*.md'); do
          # Create a new directory based on the current date
          target_dir="victoriadrake.github.io/content/$current_date"
          mkdir -p $target_dir
          # Copy the markdown file to the date-based directory
          cp "$file" "$target_dir/"
        done

    - name: Commit and push changes to victoriadrake.github.io
      run: |
        cd victoriadrake.github.io
        git config --global user.name "workflow"
        git config --global user.email "ihalp@victoria.dev"
        git add .
        git commit -m "Sync new blog posts from hashnode-blog"
        git push origin main
