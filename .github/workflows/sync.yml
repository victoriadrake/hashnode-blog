name: Sync Markdown to victoriadrake.github.io

on:
  push:
    branches:
      - main

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout hashnode-blog repo
      uses: actions/checkout@v3
      with:
        repository: victoriadrake/hashnode-blog
        path: hashnode-blog

    - name: Checkout victoriadrake.github.io repo
      uses: actions/checkout@v3
      with:
        repository: victoriadrake/victoriadrake.github.io
        path: victoriadrake.github.io
        token: ${{ secrets.TOKEN }}

    - name: Copy markdown files to victoriadrake.github.io with date-prefixed filenames
      run: |
        # Get the current date in YYYY-MM-DD format
        current_date=$(date +%Y-%m-%d)
        for file in $(find hashnode-blog/ -name '*.md'); do
          # Extract the base name of the file (without the directory path)
          base_name=$(basename "$file")
          # Create the new file name with the date prefixed
          new_file_name="${current_date}-${base_name}"
          # Copy the markdown file to the content/posts directory with the new name
          cp "$file" "victoriadrake.github.io/content/posts/$new_file_name"
        done

    - name: Commit and push changes to victoriadrake.github.io
      run: |
        cd victoriadrake.github.io
        git config --global user.name "workflow"
        git config --global user.email "ihalp@victoria.dev"
        git add .
        git commit -m "Sync new blog posts from hashnode-blog"
        git push origin master
